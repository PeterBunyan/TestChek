@model TestChek.Models.OrderedTestViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Class = "container body-content";

}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table id="aspnetusers" class="table table-bordered table-hover">
    <thead>
            @*this needs to be changed. The headers in the for loop are being displayed twice, since 2 people in list.
               Only other option I can think of is changing OrderedTestViewModel from List<AspNetUser> to just AspNetUser
                and then have the model on this page be an IEnumerable. Logic in PhsycianLinksController would need to be changed, as a result*@
            @foreach (var item in Model.patientList)
            {
            <tr>
                <th>
                    @Html.DisplayNameFor(model => item.LastName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => item.FirstName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => item.Id)
                </th>
                <th></th>
                <th></th>
                <th>Test Menu (choose all that apply)</th>
            </tr>
            }
        </thead>

    @foreach (var item in Model.patientList)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.LastName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.FirstName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Id)
            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                @Html.ActionLink("Delete", "Delete", new { id = item.Id })
            </td>
            <td>
                <button data-aspnetuser-id="@item.Id" class="btn js-order">Order New Tests</button>
                <button data-aspnetuser-id="@item.Id" class="btn js-completed">View Completed Tests</button>
            </td>

            <td>
                <select id="testMenu" class="selectpicker" multiple>
                    @foreach (var testPanel in Model.testPanelList)
                    {
                        <option data-testpanel-test="@testPanel.panelName">@testPanel.panelName</option>
                    }
                </select>
                <button data-aspnetuser-id="@item.Id" class="btn js-order">Order</button>
            </td>
            @*<td>
                    <select id="testMenu" class="selectpicker" multiple>
                        <option id="@nameof(testPanel.CBC).ToString()">CBC</option>
                        <option id="@nameof(testPanel.BasicMetPanel).ToString()">Basic Met. Panel</option>
                        <option id="@nameof(testPanel.UrineScreen).ToString()">Urine Screen</option>
                    </select>
                    <button data-aspnetuser-id="@item.Id" class="btn js-order">Order</button>
                </td>*@

            }
        </tr>
    }
</table>

@section scripts
{
    <script>

    $(document).ready(function () {
        $("#aspnetusers").DataTable();
        //$.fn.selectpicker.Constructor.BootstrapVersion = '4';
        //$("#testMenu").selectpicker('render');
        //$("#testMenu").selectpicker('refresh');

        //will probably need to change values as (this) doesn't refer to the right function yet





        @*$("#aspnetusers .js-order").on("click", function () {
        var postToAPI = { @Model.orderedTest.test: $(this).attr("data-testpanel-test"), @Model.orderedTest.Id: $(this).attr("data-aspnetuser-id") }
            if (confirm("Are you sure you want to order these tests?")) {
                $.ajax({
                    method: "POST",
                    data: JSON.stringify(postToAPI),
                    url: "/api/aspnetusers/" + $(this).attr("data-aspnetuser-id"),
                    contentType: "application/json",

                    success: function () {
                        console.log("Success");
                    }
                })
            }
        });


        $("#aspnetusers .js-order").on("click", function () {
            if (confirm("Are you sure you want to order these tests?")) {
                $.ajax({
                    url: "/api/aspnetusers/" + $(this).attr("data-aspnetuser-id"),
                    method: "PUT",
                    success: function () {
                        console.log("Success");
                    }
                })
            }
        });*@

        });
    </script>
}
